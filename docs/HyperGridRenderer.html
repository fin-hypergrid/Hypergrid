<!DOCTYPE html>

<html>
<head>
  <title>HypergridRenderer.js</title>
  <meta http-equiv="content-type" content="text/html; charset=UTF-8">
  <meta name="viewport" content="width=device-width, target-densitydpi=160dpi, initial-scale=1.0; maximum-scale=1.0; user-scalable=0;">
  <link rel="stylesheet" media="all" href="docco.css" />
</head>
<body>
  <div id="container">
    <div id="background"></div>
    
      <ul id="jump_to">
        <li>
          <a class="large" href="javascript:void(0);">Jump To &hellip;</a>
          <a class="small" href="javascript:void(0);">+</a>
          <div id="jump_wrapper">
          <div id="jump_page">
            
              
              <a class="source" href="DefaultCellProvider.html">
                DefaultCellProvider.js
              </a>
            
              
              <a class="source" href="DefaultSelectionModel.html">
                DefaultSelectionModel.js
              </a>
            
              
              <a class="source" href="Excel.html">
                Excel.js
              </a>
            
              
              <a class="source" href="Hypergrid.html">
                Hypergrid.js
              </a>
            
              
              <a class="source" href="HypergridRenderer.html">
                HypergridRenderer.js
              </a>
            
              
              <a class="source" href="DefaultGridBehavior.html">
                DefaultGridBehavior.js
              </a>
            
              
              <a class="source" href="InMemoryGridBehavior.html">
                InMemoryGridBehavior.js
              </a>
            
              
              <a class="source" href="QGridBehavior.html">
                QGridBehavior.js
              </a>
            
              
              <a class="source" href="constants.html">
                constants.js
              </a>
            
          </div>
        </li>
      </ul>
    
    <ul class="sections">
        
          <li id="title">
              <div class="annotation">
                  <h1>HypergridRenderer.js</h1>
              </div>
          </li>
        
        
        
        <li id="section-1">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-1">&#182;</a>
              </div>
              <p>HypergridRenderer is the canvas enabled top level sub component that handles the renderering of the Grid.</p>
<ul>
<li>It relies on two other external subprojects<ul>
<li>of-canvas: a wrapper to provid a simpler interface to the HTML5 canvas component</li>
<li>rectangles: a small library providing Point and Rectangle objects</li>
</ul>
</li>
</ul>

            </div>
            
        </li>
        
        
        <li id="section-2">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-2">&#182;</a>
              </div>
              <p>The HypergridRenderer is in a unique position to provide critical functionality to the OFGrid in a hightly performant manner.  Because it MUST iterate over all the visible cells it can store various bits of information that can be encapsulated as a service for consumption by the OFGrid component.</p>

            </div>
            
        </li>
        
        
        <li id="section-3">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-3">&#182;</a>
              </div>
              <p>this object is basically four main functions</p>
<ul>
<li>render fixed row headers</li>
<li>render fixed col headers</li>
<li>render main data cells</li>
<li>render grid lines</li>
</ul>

            </div>
            
            <div class="content"><div class='highlight'><pre><span class="hljs-pi">
'use strict'</span>;

<span class="hljs-keyword">var</span> constants = <span class="hljs-built_in">require</span>(<span class="hljs-string">'./constants'</span>);
<span class="hljs-keyword">var</span> ofcanvas = <span class="hljs-built_in">require</span>(<span class="hljs-string">'ofcanvas'</span>);
<span class="hljs-keyword">var</span> rectangles = <span class="hljs-built_in">require</span>(<span class="hljs-string">'rectangles'</span>);
<span class="hljs-keyword">var</span> OFCanvasComponent = ofcanvas.OFCanvasComponent;

<span class="hljs-function"><span class="hljs-keyword">function</span> <span class="hljs-title">HypergridRenderer</span><span class="hljs-params">(hypergrid)</span> </span>{

    OFCanvasComponent.call(<span class="hljs-keyword">this</span>);</pre></div></div>
            
        </li>
        
        
        <li id="section-4">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-4">&#182;</a>
              </div>
              
            </div>
            
            <div class="content"><div class='highlight'><pre>    <span class="hljs-keyword">this</span>.renderedColWidths = [<span class="hljs-number">0</span>];
    <span class="hljs-keyword">this</span>.renderedRowHeights = [<span class="hljs-number">0</span>];
    <span class="hljs-keyword">this</span>.renderedCols = [];
    <span class="hljs-keyword">this</span>.renderedRows = [];

    <span class="hljs-keyword">this</span>.getGrid = <span class="hljs-function"><span class="hljs-keyword">function</span><span class="hljs-params">()</span> </span>{
        <span class="hljs-keyword">return</span> hypergrid;
    };</pre></div></div>
            
        </li>
        
        
        <li id="section-5">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-5">&#182;</a>
              </div>
              <p>This is the entry point from OFCanvas.  Notify the OFGrid everytime we’ve repainted.</p>

            </div>
            
            <div class="content"><div class='highlight'><pre>    <span class="hljs-keyword">this</span>.paint = <span class="hljs-function"><span class="hljs-keyword">function</span><span class="hljs-params">(gc)</span> </span>{
        <span class="hljs-keyword">this</span>.renderGrid(gc);
        <span class="hljs-keyword">this</span>.getGrid().gridRenderedNotification();
    };</pre></div></div>
            
        </li>
        
        
        <li id="section-6">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-6">&#182;</a>
              </div>
              <p>Answer how many rows we rendered</p>

            </div>
            
            <div class="content"><div class='highlight'><pre>    <span class="hljs-keyword">this</span>.getViewableRows = <span class="hljs-function"><span class="hljs-keyword">function</span><span class="hljs-params">()</span> </span>{
        <span class="hljs-keyword">return</span> <span class="hljs-keyword">this</span>.renderedRows.length;
    };</pre></div></div>
            
        </li>
        
        
        <li id="section-7">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-7">&#182;</a>
              </div>
              <p>Answer how many columns we just rendered</p>

            </div>
            
            <div class="content"><div class='highlight'><pre>    <span class="hljs-keyword">this</span>.getViewableCols = <span class="hljs-function"><span class="hljs-keyword">function</span><span class="hljs-params">()</span> </span>{
        <span class="hljs-keyword">return</span> <span class="hljs-keyword">this</span>.renderedCols.length;
    };</pre></div></div>
            
        </li>
        
        
        <li id="section-8">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-8">&#182;</a>
              </div>
              <p>Answer the pixel bounds of specific data cell. It must have just been rendered</p>

            </div>
            
            <div class="content"><div class='highlight'><pre>    <span class="hljs-keyword">this</span>.getBoundsOfCell = <span class="hljs-function"><span class="hljs-keyword">function</span><span class="hljs-params">(cell)</span> </span>{
        <span class="hljs-keyword">var</span> ox = <span class="hljs-keyword">this</span>.renderedColWidths[cell.x],
            oy = <span class="hljs-keyword">this</span>.renderedRowHeights[cell.y],
            cx = <span class="hljs-keyword">this</span>.renderedColWidths[cell.x + <span class="hljs-number">1</span>],
            cy = <span class="hljs-keyword">this</span>.renderedRowHeights[cell.y + <span class="hljs-number">1</span>],
            ex = cx - ox,
            ey = cy - oy;

        <span class="hljs-keyword">var</span> bounds = <span class="hljs-keyword">new</span> rectangles.Rectangle(ox, oy, ex, ey);

        <span class="hljs-keyword">return</span> bounds;
    };</pre></div></div>
            
        </li>
        
        
        <li id="section-9">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-9">&#182;</a>
              </div>
              <p>Answer specific data cell coordinates given mouse coordinates in pixels.</p>

            </div>
            
            <div class="content"><div class='highlight'><pre>    <span class="hljs-keyword">this</span>.getCellFromMousePoint = <span class="hljs-function"><span class="hljs-keyword">function</span><span class="hljs-params">(point)</span> </span>{

        <span class="hljs-keyword">var</span> width = <span class="hljs-number">0</span>;
        <span class="hljs-keyword">var</span> height = <span class="hljs-number">0</span>;
        <span class="hljs-keyword">var</span> x, y;
        <span class="hljs-keyword">var</span> c, r;
        <span class="hljs-keyword">var</span> previous = <span class="hljs-number">0</span>;
        <span class="hljs-keyword">for</span> (c = <span class="hljs-number">1</span>; c &lt; <span class="hljs-keyword">this</span>.renderedColWidths.length; c++) {
            width = <span class="hljs-keyword">this</span>.renderedColWidths[c];
            <span class="hljs-keyword">if</span> (point.x &lt; width) {
                x = <span class="hljs-built_in">Math</span>.max(<span class="hljs-number">0</span>, point.x - previous - <span class="hljs-number">2</span>);
                <span class="hljs-keyword">break</span>;
            }
            previous = width;
        }
        c--;
        previous = <span class="hljs-number">0</span>;
        <span class="hljs-keyword">for</span> (r = <span class="hljs-number">1</span>; r &lt; <span class="hljs-keyword">this</span>.renderedRowHeights.length; r++) {
            height = <span class="hljs-keyword">this</span>.renderedRowHeights[r];
            <span class="hljs-keyword">if</span> (point.y &lt; height) {
                y = <span class="hljs-built_in">Math</span>.max(<span class="hljs-number">0</span>, point.y - previous - <span class="hljs-number">2</span>);
                <span class="hljs-keyword">break</span>;
            }
            previous = height;
        }
        r--;
        <span class="hljs-keyword">if</span> (point.x &lt; <span class="hljs-number">0</span>) {
            c = -<span class="hljs-number">1</span>;
        }
        <span class="hljs-keyword">if</span> (point.y &lt; <span class="hljs-number">0</span>) {
            r = -<span class="hljs-number">1</span>;
        }

        <span class="hljs-keyword">return</span> {
            cell: <span class="hljs-keyword">new</span> rectangles.Point(c, r),
            location: <span class="hljs-keyword">new</span> rectangles.Point(x, y)
        };
    };</pre></div></div>
            
        </li>
        
        
        <li id="section-10">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-10">&#182;</a>
              </div>
              <p>Answer if a column is visible, must be fully visible</p>

            </div>
            
            <div class="content"><div class='highlight'><pre>    <span class="hljs-keyword">this</span>.isColVisible = <span class="hljs-function"><span class="hljs-keyword">function</span><span class="hljs-params">(c)</span> </span>{
        <span class="hljs-keyword">var</span> isVisible = <span class="hljs-keyword">this</span>.renderedCols.indexOf(c) !== -<span class="hljs-number">1</span>;
        <span class="hljs-keyword">return</span> isVisible;
    };</pre></div></div>
            
        </li>
        
        
        <li id="section-11">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-11">&#182;</a>
              </div>
              <p>Answer if a row is visible, must be fully visible</p>

            </div>
            
            <div class="content"><div class='highlight'><pre>    <span class="hljs-keyword">this</span>.isRowVisible = <span class="hljs-function"><span class="hljs-keyword">function</span><span class="hljs-params">(r)</span> </span>{
        <span class="hljs-keyword">var</span> isVisible = <span class="hljs-keyword">this</span>.renderedRows.indexOf(r) !== -<span class="hljs-number">1</span>;
        <span class="hljs-keyword">return</span> isVisible;
    };

    <span class="hljs-keyword">this</span>.setBackgroundColor(constants.gridBackgroundColor);
}

<span class="hljs-keyword">var</span> proto = HypergridRenderer.prototype = <span class="hljs-built_in">Object</span>.create(OFCanvasComponent.prototype);</pre></div></div>
            
        </li>
        
        
        <li id="section-12">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-12">&#182;</a>
              </div>
              <p>Answer if a data cell is selected.</p>

            </div>
            
            <div class="content"><div class='highlight'><pre>proto.isSelected = <span class="hljs-function"><span class="hljs-keyword">function</span><span class="hljs-params">(x, y)</span> </span>{
    <span class="hljs-keyword">return</span> <span class="hljs-keyword">this</span>.getGrid().isSelected(x, y);
};</pre></div></div>
            
        </li>
        
        
        <li id="section-13">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-13">&#182;</a>
              </div>
              <p>This is the main forking of the renderering task.  GC is a graphics context.
<br><a href="https://developer.mozilla.org/en-US/docs/Web/API/CanvasRenderingContext2D">CanvasRenderingContext2D</a></p>

            </div>
            
            <div class="content"><div class='highlight'><pre>proto.renderGrid = <span class="hljs-function"><span class="hljs-keyword">function</span><span class="hljs-params">(gc)</span> </span>{
    <span class="hljs-keyword">var</span> offsetX = <span class="hljs-keyword">this</span>.getBehavior().getFixedColsWidth();
    <span class="hljs-keyword">var</span> offsetY = <span class="hljs-keyword">this</span>.getBehavior().getFixedRowsHeight();

    <span class="hljs-keyword">this</span>.paintCells(gc, offsetX, offsetY);
    <span class="hljs-keyword">this</span>.paintHeaders(gc, <span class="hljs-number">0</span>, <span class="hljs-number">0</span>);
    <span class="hljs-keyword">this</span>.paintGridlines(gc, offsetX, offsetY);
};</pre></div></div>
            
        </li>
        
        
        <li id="section-14">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-14">&#182;</a>
              </div>
              <p>We opted to not paint borders for each cell as that was extremely expensive.  Instead we draw gridlines here.  Also we record the widths and heights for later.</p>

            </div>
            
            <div class="content"><div class='highlight'><pre>proto.paintGridlines = <span class="hljs-function"><span class="hljs-keyword">function</span><span class="hljs-params">(gc, offsetX, offsetY)</span> </span>{
    <span class="hljs-keyword">var</span> behavior = <span class="hljs-keyword">this</span>.getBehavior();
    <span class="hljs-keyword">var</span> lineColor = constants.lineColor; <span class="hljs-comment">//draw horizontal grid line</span>

    <span class="hljs-keyword">var</span> numCols = behavior.getColCount();
    <span class="hljs-keyword">var</span> numRows = behavior.getRowCount();
    <span class="hljs-keyword">var</span> numFixedCols = behavior.getFixedColCount();
    <span class="hljs-keyword">var</span> numFixedRows = behavior.getFixedRowCount();

    <span class="hljs-keyword">var</span> fixedColsWidth = behavior.getFixedColsWidth();
    <span class="hljs-keyword">var</span> fixedRowsHeight = behavior.getFixedRowsHeight();

    <span class="hljs-keyword">this</span>.renderedColWidths = [<span class="hljs-number">0</span>];
    <span class="hljs-keyword">this</span>.renderedRowHeights = [<span class="hljs-number">0</span>];
    <span class="hljs-keyword">this</span>.renderedCols = [];
    <span class="hljs-keyword">this</span>.renderedRows = [];

    <span class="hljs-keyword">var</span> scrollTop = <span class="hljs-keyword">this</span>.getScrollTop();
    <span class="hljs-keyword">var</span> scrollLeft = <span class="hljs-keyword">this</span>.getScrollLeft();
    <span class="hljs-keyword">var</span> viewWidth = <span class="hljs-keyword">this</span>.getBounds().width();
    <span class="hljs-keyword">var</span> viewHeight = <span class="hljs-keyword">this</span>.getBounds().height();


    gc.strokeStyle = lineColor;
    gc.lineWidth = <span class="hljs-number">1</span>;
    <span class="hljs-keyword">var</span> c, r, x, y, width, height;</pre></div></div>
            
        </li>
        
        
        <li id="section-15">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-15">&#182;</a>
              </div>
              <p>fixedrow horiontal grid lines</p>

            </div>
            
            <div class="content"><div class='highlight'><pre>    gc.beginPath();
    gc.moveTo(<span class="hljs-number">0</span>, <span class="hljs-number">0</span>);
    y = <span class="hljs-number">0</span>;
    <span class="hljs-keyword">for</span> (r = <span class="hljs-number">0</span>; r &lt; numFixedRows; r++) {
        height = <span class="hljs-keyword">this</span>.getFixedRowHeight(r);
        y = y + height;
        <span class="hljs-keyword">this</span>.renderedRowHeights.push(y);
        gc.moveTo(fixedColsWidth, y);
        gc.lineTo(viewWidth, y);
        gc.stroke();
    }</pre></div></div>
            
        </li>
        
        
        <li id="section-16">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-16">&#182;</a>
              </div>
              <p>fixedcol vertical grid lines</p>

            </div>
            
            <div class="content"><div class='highlight'><pre>    gc.beginPath();
    gc.moveTo(<span class="hljs-number">0</span>, <span class="hljs-number">0</span>);
    x = <span class="hljs-number">0</span>;
    <span class="hljs-keyword">for</span> (c = <span class="hljs-number">0</span>; c &lt; numFixedCols; c++) {
        width = <span class="hljs-keyword">this</span>.getFixedColWidth(c);
        x = x + width;
        <span class="hljs-keyword">this</span>.renderedColWidths.push(x);
        gc.moveTo(x, fixedRowsHeight);
        gc.lineTo(x, viewHeight);
        gc.stroke();
    }</pre></div></div>
            
        </li>
        
        
        <li id="section-17">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-17">&#182;</a>
              </div>
              <p>main area vertical grid lines</p>

            </div>
            
            <div class="content"><div class='highlight'><pre>    gc.beginPath();
    gc.moveTo(<span class="hljs-number">0</span>, <span class="hljs-number">0</span>);
    x = offsetX;
    <span class="hljs-keyword">for</span> (c = <span class="hljs-number">0</span>; c &lt; numCols; c++) {
        width = <span class="hljs-keyword">this</span>.getColWidth(c + scrollLeft);

        <span class="hljs-keyword">this</span>.renderedCols.push(c + scrollLeft);

        <span class="hljs-keyword">if</span> (x &gt; viewWidth || numCols &lt; scrollLeft + c) {
            <span class="hljs-keyword">this</span>.renderedCols.length = <span class="hljs-built_in">Math</span>.max(<span class="hljs-number">0</span>, <span class="hljs-keyword">this</span>.renderedCols.length - <span class="hljs-number">2</span>);
            <span class="hljs-keyword">break</span>;
        }
        gc.moveTo(x, <span class="hljs-number">0</span>);
        gc.lineTo(x, viewHeight);
        gc.stroke();
        x = x + width;
        <span class="hljs-keyword">this</span>.renderedColWidths.push(x);
    }</pre></div></div>
            
        </li>
        
        
        <li id="section-18">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-18">&#182;</a>
              </div>
              <p>main area horizontal grid lines</p>

            </div>
            
            <div class="content"><div class='highlight'><pre>    gc.beginPath();
    gc.moveTo(<span class="hljs-number">0</span>, <span class="hljs-number">0</span>);
    y = offsetY;
    <span class="hljs-keyword">for</span> (r = <span class="hljs-number">0</span>; r &lt; numRows; r++) {
        height = <span class="hljs-keyword">this</span>.getRowHeight(r + scrollTop);

        <span class="hljs-keyword">this</span>.renderedRows.push(r + scrollTop);

        <span class="hljs-keyword">if</span> (y &gt; viewHeight || numRows &lt; scrollTop + r) {
            <span class="hljs-keyword">this</span>.renderedRows.length = <span class="hljs-built_in">Math</span>.max(<span class="hljs-number">0</span>, <span class="hljs-keyword">this</span>.renderedRows.length - <span class="hljs-number">2</span>);
            <span class="hljs-keyword">break</span>;
        }
        gc.moveTo(<span class="hljs-number">0</span>, y);
        gc.lineTo(viewWidth, y);
        gc.stroke();
        y = y + height;
        <span class="hljs-keyword">this</span>.renderedRowHeights.push(y);
    }

};

proto.paintHeaders = <span class="hljs-function"><span class="hljs-keyword">function</span><span class="hljs-params">(ctx, offsetX, offsetY)</span> </span>{

    <span class="hljs-keyword">this</span>.paintFixedRows(
        ctx,
        offsetX + <span class="hljs-keyword">this</span>.getBehavior().getFixedColsWidth(),
        offsetY,
        <span class="hljs-keyword">this</span>.getBehavior().getColCount(),
        <span class="hljs-keyword">this</span>.getBehavior().getFixedRowCount());

    <span class="hljs-keyword">this</span>.paintFixedCols(
        ctx,
        offsetX,
        offsetY + <span class="hljs-keyword">this</span>.getBehavior().getFixedRowsHeight(),
        <span class="hljs-keyword">this</span>.getBehavior().getFixedColCount(),
        <span class="hljs-keyword">this</span>.getBehavior().getRowCount());

    <span class="hljs-keyword">this</span>.paintTopLeft(ctx, <span class="hljs-number">0</span>, <span class="hljs-number">0</span>);
};</pre></div></div>
            
        </li>
        
        
        <li id="section-19">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-19">&#182;</a>
              </div>
              <p>We have a reuseable cellConfig object that is repopulated for every cell renderering.  It should be attached to the cell inside of the getCell, getFixedColCell, and getFixedRowCell functions.</p>

            </div>
            
            <div class="content"><div class='highlight'><pre><span class="hljs-keyword">var</span> config = {};
<span class="hljs-keyword">var</span> cellConfig = <span class="hljs-function"><span class="hljs-keyword">function</span><span class="hljs-params">(x, y, value, fgColor, bgColor, fgSelColor, bgSelColor, font, isSelected, halign)</span> </span>{
    config.x = x;
    config.y = y;
    config.value = value;
    config.fgColor = fgColor;
    config.bgColor = constants.backgroundColor === bgColor ? <span class="hljs-literal">null</span> : bgColor;
    config.fgSelColor = fgSelColor;
    config.bgSelColor = bgSelColor;
    config.font = font;
    config.isSelected = isSelected;
    config.halign = halign || <span class="hljs-string">'center'</span>;
    <span class="hljs-keyword">return</span> config;
};</pre></div></div>
            
        </li>
        
        
        <li id="section-20">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-20">&#182;</a>
              </div>
              <p>Renderer the fixed header rows along the top</p>

            </div>
            
            <div class="content"><div class='highlight'><pre>proto.paintFixedRows = <span class="hljs-function"><span class="hljs-keyword">function</span><span class="hljs-params">(ctx, offsetX, offsetY, numCols, numRows)</span> </span>{
    <span class="hljs-keyword">var</span> behavior = <span class="hljs-keyword">this</span>.getBehavior();
    <span class="hljs-keyword">var</span> x = offsetX;
    <span class="hljs-keyword">var</span> scrollLeft = <span class="hljs-keyword">this</span>.getScrollLeft();
    <span class="hljs-keyword">var</span> font = constants.defaultFont;
    <span class="hljs-keyword">var</span> fgColor = constants.foregroundColor;
    <span class="hljs-keyword">var</span> bgColor = constants.backgroundColor;
    <span class="hljs-keyword">var</span> fgSelColor = constants.fixedRowFGSelColor;
    <span class="hljs-keyword">var</span> bgSelColor = constants.fixedRowBGSelColor;
    <span class="hljs-keyword">var</span> fixedRowBGColor = constants.fixedRowBGColor;
    <span class="hljs-keyword">var</span> halign = constants.fixedRowAlign;
    <span class="hljs-keyword">var</span> cellProvider = <span class="hljs-keyword">this</span>.getGrid().getCellProvider();
    <span class="hljs-keyword">var</span> viewWidth = <span class="hljs-keyword">this</span>.getBounds().width();
    <span class="hljs-keyword">var</span> viewHeight = <span class="hljs-keyword">this</span>.getBehavior().getFixedRowsHeight();
    <span class="hljs-keyword">for</span> (<span class="hljs-keyword">var</span> c = <span class="hljs-number">0</span>; c &lt; numCols; c++) {
        <span class="hljs-keyword">var</span> width = <span class="hljs-keyword">this</span>.getColWidth(c + scrollLeft);
        <span class="hljs-keyword">if</span> (x &gt; viewWidth || numCols &lt;= scrollLeft + c) {
            <span class="hljs-keyword">return</span>;
        }
        <span class="hljs-keyword">var</span> isSelected = <span class="hljs-keyword">this</span>.isFixedRowCellSelected(c + scrollLeft);
        <span class="hljs-keyword">var</span> y = offsetY;

        ctx.fillStyle = fixedRowBGColor;
        ctx.fillRect(x, y, x + width, viewHeight - y);

        <span class="hljs-keyword">for</span> (<span class="hljs-keyword">var</span> r = <span class="hljs-number">0</span>; r &lt; numRows; r++) {

            <span class="hljs-keyword">var</span> height = <span class="hljs-keyword">this</span>.getFixedRowHeight(r);
            <span class="hljs-keyword">var</span> value = behavior.getFixedRowValue(c + scrollLeft, r);

            <span class="hljs-keyword">var</span> cell = cellProvider.getFixedRowCell(cellConfig(c + scrollLeft, r, value, fgColor, bgColor, fgSelColor, bgSelColor, font, isSelected, halign));
            cell.paint(ctx, x, y, width, height);
            y = y + height;
        }
        x = x + width;
    }
};</pre></div></div>
            
        </li>
        
        
        <li id="section-21">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-21">&#182;</a>
              </div>
              <p>Render the fixed columns along the left side</p>

            </div>
            
            <div class="content"><div class='highlight'><pre>proto.paintFixedCols = <span class="hljs-function"><span class="hljs-keyword">function</span><span class="hljs-params">(ctx, offsetX, offsetY, numCols, numRows)</span> </span>{
    <span class="hljs-keyword">var</span> behavior = <span class="hljs-keyword">this</span>.getBehavior();
    <span class="hljs-keyword">var</span> x = offsetX;
    <span class="hljs-keyword">var</span> font = constants.defaultFont;
    <span class="hljs-keyword">var</span> fgColor = constants.foregroundColor;
    <span class="hljs-keyword">var</span> bgColor = constants.backgroundColor;
    <span class="hljs-keyword">var</span> fixedColBGColor = constants.fixedColBGColor;
    <span class="hljs-keyword">var</span> fgSelColor = constants.fixedColFGSelColor;
    <span class="hljs-keyword">var</span> bgSelColor = constants.fixedColBGSelColor;
    <span class="hljs-keyword">var</span> halign = constants.fixedColAlign;
    <span class="hljs-keyword">var</span> scrollTop = <span class="hljs-keyword">this</span>.getScrollTop();
    <span class="hljs-keyword">var</span> cellProvider = <span class="hljs-keyword">this</span>.getGrid().getCellProvider();
    <span class="hljs-keyword">var</span> viewHeight = <span class="hljs-keyword">this</span>.getBounds().height();

    <span class="hljs-keyword">for</span> (<span class="hljs-keyword">var</span> c = <span class="hljs-number">0</span>; c &lt; numCols; c++) {
        <span class="hljs-keyword">var</span> width = <span class="hljs-keyword">this</span>.getFixedColWidth(c);
        <span class="hljs-keyword">var</span> y = offsetY;

        ctx.fillStyle = fixedColBGColor;
        ctx.fillRect(x, y, width, viewHeight - y);

        <span class="hljs-keyword">for</span> (<span class="hljs-keyword">var</span> r = <span class="hljs-number">0</span>; r &lt; numRows; r++) {
            <span class="hljs-keyword">var</span> height = <span class="hljs-keyword">this</span>.getRowHeight(r + scrollTop);
            <span class="hljs-keyword">var</span> isSelected = <span class="hljs-keyword">this</span>.isFixedColCellSelected(r + scrollTop);
            <span class="hljs-keyword">if</span> (y &gt; viewHeight || numRows &lt;= scrollTop + r) {
                <span class="hljs-keyword">break</span>;
            }
            <span class="hljs-keyword">var</span> value = behavior.getFixedColValue(c, r + scrollTop);
            <span class="hljs-keyword">var</span> cell = cellProvider.getFixedColCell(cellConfig(c, r + scrollTop, value, fgColor, bgColor, fgSelColor, bgSelColor, font, isSelected, halign));
            cell.paint(ctx, x, y, width, height);
            y = y + height;
        }
        x = x + width;
    }
};</pre></div></div>
            
        </li>
        
        
        <li id="section-22">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-22">&#182;</a>
              </div>
              <p>Render the main cells.  We snapshot the context to insure against its polution.
<br>TODO:save/restore should be a general wrapper that we use here and for the other renderer, fixed rows/cols and gridlines as well.</p>

            </div>
            
            <div class="content"><div class='highlight'><pre>proto.paintCells = <span class="hljs-function"><span class="hljs-keyword">function</span><span class="hljs-params">(ctx, offsetX, offsetY)</span> </span>{
    <span class="hljs-keyword">try</span> {
        ctx.save();
        <span class="hljs-keyword">this</span>._paintCells(ctx, offsetX, offsetY);
    } <span class="hljs-keyword">finally</span> {
        ctx.restore();
    }
};
proto._paintCells = <span class="hljs-function"><span class="hljs-keyword">function</span><span class="hljs-params">(ctx, offsetX, offsetY)</span> </span>{
    <span class="hljs-keyword">var</span> behavior = <span class="hljs-keyword">this</span>.getBehavior();
    <span class="hljs-keyword">var</span> numCols = behavior.getColCount();
    <span class="hljs-keyword">var</span> numRows = behavior.getRowCount();
    <span class="hljs-keyword">var</span> x = offsetX;
    <span class="hljs-keyword">var</span> startY = offsetY;
    <span class="hljs-keyword">var</span> scrollTop = <span class="hljs-keyword">this</span>.getScrollTop();
    <span class="hljs-keyword">var</span> scrollLeft = <span class="hljs-keyword">this</span>.getScrollLeft();
    <span class="hljs-keyword">var</span> cellProvider = <span class="hljs-keyword">this</span>.getGrid().getCellProvider();
    <span class="hljs-keyword">var</span> font = constants.defaultFont;
    <span class="hljs-keyword">var</span> fgColor = constants.foregroundColor;
    <span class="hljs-keyword">var</span> bgColor = constants.backgroundColor;
    <span class="hljs-keyword">var</span> fgSelColor = constants.foregroundSelColor;
    <span class="hljs-keyword">var</span> bgSelColor = constants.backgroundSelColor;
    <span class="hljs-keyword">var</span> viewWidth = <span class="hljs-keyword">this</span>.getBounds().width();
    <span class="hljs-keyword">var</span> viewHeight = <span class="hljs-keyword">this</span>.getBounds().height();

    <span class="hljs-keyword">for</span> (<span class="hljs-keyword">var</span> c = <span class="hljs-number">0</span>; c &lt; numCols; c++) {
        <span class="hljs-keyword">var</span> width = <span class="hljs-keyword">this</span>.getColWidth(c + scrollLeft);
        <span class="hljs-keyword">if</span> (x &gt; viewWidth || numCols &lt;= scrollLeft + c) {
            <span class="hljs-keyword">return</span>;
        }

        <span class="hljs-keyword">var</span> y = startY;
        <span class="hljs-keyword">var</span> colAlign = behavior.getColAlignment(c + scrollLeft);</pre></div></div>
            
        </li>
        
        
        <li id="section-23">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-23">&#182;</a>
              </div>
              <p>fill background</p>

            </div>
            
            <div class="content"><div class='highlight'><pre>        ctx.fillStyle = bgColor;
        ctx.fillRect(x, y, x + width, viewHeight - y);

        <span class="hljs-keyword">for</span> (<span class="hljs-keyword">var</span> r = <span class="hljs-number">0</span>; r &lt; numRows; r++) {
            <span class="hljs-keyword">var</span> isSelected = <span class="hljs-keyword">this</span>.isSelected(c + scrollLeft, r + scrollTop);
            <span class="hljs-keyword">var</span> height = <span class="hljs-keyword">this</span>.getRowHeight(r + scrollTop);
            <span class="hljs-keyword">if</span> (y &gt; viewHeight || numRows &lt;= scrollTop + r) {
                <span class="hljs-keyword">break</span>;
            }

            <span class="hljs-keyword">var</span> value = behavior.getValue(c + scrollLeft, r + scrollTop);</pre></div></div>
            
        </li>
        
        
        <li id="section-24">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-24">&#182;</a>
              </div>
              <p>if (!value &amp;&amp; value !== 0) { // edge condition if were scrolled all the way to the end
    break;
}</p>

            </div>
            
            <div class="content"><div class='highlight'><pre>            <span class="hljs-keyword">var</span> cell = cellProvider.getCell(cellConfig(c + scrollLeft, r + scrollTop, value, fgColor, bgColor, fgSelColor, bgSelColor, font, isSelected, colAlign));

            cell.paint(ctx, x, y, width, height);

            y = y + height;
        }

        x = x + width;
    }
};</pre></div></div>
            
        </li>
        
        
        <li id="section-25">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-25">&#182;</a>
              </div>
              <p>This is the empty top left corner of the grid.</p>

            </div>
            
            <div class="content"><div class='highlight'><pre>proto.paintTopLeft = <span class="hljs-function"><span class="hljs-keyword">function</span><span class="hljs-params">(ctx, offsetX, offsetY)</span> </span>{
    ctx.beginPath();</pre></div></div>
            
        </li>
        
        
        <li id="section-26">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-26">&#182;</a>
              </div>
              <p>var border = this.getGrid().provider.require(‘borderprovider’).getBorder(‘simple’);</p>

            </div>
            
            <div class="content"><div class='highlight'><pre>    <span class="hljs-keyword">var</span> fixedRowHeight = <span class="hljs-keyword">this</span>.getBehavior().getFixedRowsHeight();
    <span class="hljs-keyword">var</span> fixedColWidth = <span class="hljs-keyword">this</span>.getBehavior().getFixedColsWidth();
    ctx.fillStyle = constants.topLeftHeaderBGColor;
    ctx.fillRect(offsetX, offsetY, fixedColWidth, fixedRowHeight);</pre></div></div>
            
        </li>
        
        
        <li id="section-27">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-27">&#182;</a>
              </div>
              <p>border.paint(ctx, offsetX, offsetY, fixedColWidth, fixedRowHeight, constants.lineColor);</p>

            </div>
            
            <div class="content"><div class='highlight'><pre>    ctx.stroke();
};

proto.isFixedRowCellSelected = <span class="hljs-function"><span class="hljs-keyword">function</span><span class="hljs-params">(col)</span> </span>{
    <span class="hljs-keyword">return</span> <span class="hljs-keyword">this</span>.getGrid().isFixedRowCellSelected(col);
};

proto.isFixedColCellSelected = <span class="hljs-function"><span class="hljs-keyword">function</span><span class="hljs-params">(row)</span> </span>{
    <span class="hljs-keyword">return</span> <span class="hljs-keyword">this</span>.getGrid().isFixedColCellSelected(row);
};

proto.getScrollTop = <span class="hljs-function"><span class="hljs-keyword">function</span><span class="hljs-params">()</span> </span>{
    <span class="hljs-keyword">var</span> st = <span class="hljs-keyword">this</span>.getGrid().getVScrollValue();
    <span class="hljs-keyword">return</span> st;
};

proto.getScrollLeft = <span class="hljs-function"><span class="hljs-keyword">function</span><span class="hljs-params">()</span> </span>{
    <span class="hljs-keyword">var</span> st = <span class="hljs-keyword">this</span>.getGrid().getHScrollValue();
    <span class="hljs-keyword">return</span> st;
};

proto.getBehavior = <span class="hljs-function"><span class="hljs-keyword">function</span><span class="hljs-params">()</span> </span>{
    <span class="hljs-keyword">return</span> <span class="hljs-keyword">this</span>.getGrid().getBehavior();
};

proto.getConstants = <span class="hljs-function"><span class="hljs-keyword">function</span><span class="hljs-params">()</span> </span>{
    <span class="hljs-keyword">return</span> <span class="hljs-keyword">this</span>.getGrid().constants;
};

proto.getFixedRowHeight = <span class="hljs-function"><span class="hljs-keyword">function</span><span class="hljs-params">(rowIndex)</span> </span>{
    <span class="hljs-keyword">var</span> height = <span class="hljs-keyword">this</span>.getBehavior().getFixedRowHeight(rowIndex);
    <span class="hljs-keyword">return</span> height;
};

proto.getRowHeight = <span class="hljs-function"><span class="hljs-keyword">function</span><span class="hljs-params">(rowIndex)</span> </span>{
    <span class="hljs-keyword">var</span> height = <span class="hljs-keyword">this</span>.getBehavior().getRowHeight(rowIndex);
    <span class="hljs-keyword">return</span> height;
};

proto.getColWidth = <span class="hljs-function"><span class="hljs-keyword">function</span><span class="hljs-params">(colIndex)</span> </span>{
    <span class="hljs-keyword">var</span> width = <span class="hljs-keyword">this</span>.getBehavior().getColWidth(colIndex);
    <span class="hljs-keyword">return</span> width;
};

proto.getFixedColWidth = <span class="hljs-function"><span class="hljs-keyword">function</span><span class="hljs-params">(rowIndex)</span> </span>{
    <span class="hljs-keyword">var</span> height = <span class="hljs-keyword">this</span>.getBehavior().getFixedColWidth(rowIndex);
    <span class="hljs-keyword">return</span> height;
};

<span class="hljs-built_in">module</span>.exports = proto.constructor = HypergridRenderer;</pre></div></div>
            
        </li>
        
    </ul>
  </div>
</body>
</html>
